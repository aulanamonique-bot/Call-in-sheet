<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Quote Calculator</title>
  <style>
    :root{
      --bg:#f7edf3;
      --panel:#ffffff;
      --ink:#161616;
      --muted:#6b6b73;
      --line:#f0c1d9;
      --line2:#eadde5;
      --pink:#f43f95;
      --pink2:#ec5da8;
      --pinkSoft:#fff4fa;
      --chip:#fff;
      --shadow:0 10px 26px rgba(0,0,0,.06);
      --r:18px;
      --r2:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:var(--bg);
    }
    .wrap{max-width:1360px;margin:14px auto;padding:0 12px 26px}
    /* Top bar */
    .topbar{
      background:rgba(255,255,255,.9);
      border:1px solid var(--line2);
      border-radius:14px;
      box-shadow:var(--shadow);
      padding:12px;
      display:grid;
      grid-template-columns: 1.2fr auto auto auto auto;
      gap:10px;
      align-items:end;
      margin-bottom:14px;
    }
    .brand h1{margin:0;font-size:20px;font-weight:950;letter-spacing:.35px}
    .brand p{margin:3px 0 0;color:var(--muted);font-size:12px;font-weight:650}
    .miniField{display:grid;gap:4px}
    .miniField label{font-size:12px;font-weight:850;color:#3f3f46}
    .miniField input{
      height:38px; padding:8px 10px;
      border:1px solid var(--line);
      border-radius:12px;
      background:#fff;
      font-weight:800;
      min-width:140px;
    }
    .btn{
      height:38px;
      border-radius:12px;
      padding:0 14px;
      font-weight:900;
      font-size:14px;
      cursor:pointer;
      border:1px solid transparent;
      white-space:nowrap;
    }
    .btn-primary{background:var(--pink);color:#fff}
    .btn-soft{background:#ffecf5;color:#b10b5f;border-color:#ffc8e2}
    .btn-ghost{background:#fff;color:#222;border-color:var(--line)}
    .btn:active{transform:translateY(1px)}
    /* Layout */
    .main{
      display:grid;
      grid-template-columns: 360px 1fr 460px;
      gap:14px;
      align-items:start;
    }
    .card{
      background:var(--panel);
      border:1px solid var(--line2);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .head{
      background:linear-gradient(180deg,var(--pink2),var(--pink));
      color:#fff;
      padding:10px 14px;
      font-weight:950;
      font-size:15px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .body{padding:12px}
    .stack{display:grid;gap:10px}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
    .field{display:grid;gap:4px}
    .field label{font-size:12px;font-weight:850;color:#4a4a52;line-height:1.2}
    .field input,.field textarea{
      width:100%; min-width:0;
      height:40px;
      border:1px solid var(--line);
      border-radius:12px;
      background:#fff;
      padding:8px 10px;
      font-size:14px;
      font-weight:750;
      color:#1c1c22;
      outline:none;
    }
    .field textarea{height:86px;resize:vertical;line-height:1.25;padding-top:10px}
    .field.compact input{height:36px}
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0;}
    input[type=number]{ -moz-appearance:textfield; }
    .sticky{position:sticky;top:12px;max-height:calc(100vh - 24px);overflow:auto}
    /* Checklist chips */
    .chipGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
    .chip{
      border:1px solid var(--line);
      border-radius:999px;
      background:var(--chip);
      height:38px;
      display:flex;align-items:center;justify-content:center;gap:8px;
      font-weight:900;cursor:pointer;user-select:none;
    }
    .chip input{margin:0;width:16px;height:16px;accent-color:var(--pink)}
    .chip.on{background:#fff0f7;border-color:#ff9dcb}
    /* Center: quote read */
    .quoteGrid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    .metric{
      border:1px solid var(--line);
      border-radius:14px;
      background:#fff7fb;
      padding:10px;
    }
    .metric .k{font-size:11px;font-weight:900;color:#50505a}
    .metric .v{font-size:20px;font-weight:1000;margin:5px 0 2px;line-height:1.05}
    .metric .sub{font-size:11px;color:#50505a;font-weight:800}
    .metric.big .v{font-size:22px}
    .divider{border-top:1px dashed var(--line);margin:10px 0}
    /* Toggles */
    .toggles{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
    .toggle{
      height:40px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#fff;
      font-weight:950;
      cursor:pointer;
    }
    .toggle.on{
      background:var(--pink);
      border-color:var(--pink);
      color:#fff;
    }
    .hint{font-size:12px;color:var(--muted);font-weight:700}
    /* Right: measurements + adjust */
    .miniPanel{
      border:1px solid var(--line2);
      border-radius:14px;
      background:var(--pinkSoft);
      padding:10px;
    }
    .miniPanel h4{margin:0 0 8px;font-size:13px;font-weight:950}
    details summary{cursor:pointer;font-weight:900}
    table{width:100%;border-collapse:collapse;font-size:12px}
    th,td{border:1px solid var(--line);padding:6px}
    th{text-align:left;background:#fff}
    td.right{text-align:right;font-weight:900}
    .adjustGrid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .adjustBox{
      border:1px solid var(--line);
      border-radius:14px;
      background:#fff;
      padding:10px;
    }
    .adjustBox h5{
      margin:0 0 8px;
      font-size:12px;
      font-weight:1000;
      color:#4d4d56;
      display:flex;
      justify-content:space-between;
      gap:8px;
    }
    .smallGrid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .field.mini label{font-size:11px}
    .readonly{background:#fff7fb;font-weight:900}
    .totalsList{display:grid;gap:8px}
    .totalsRow{
      display:flex;justify-content:space-between;gap:10px;
      padding:8px 10px;
      border:1px solid var(--line);
      border-radius:12px;
      background:#fff;
      font-weight:900;
    }
    .totalsRow .lab{font-size:12px;color:#4a4a52}
    .totalsRow .amt{font-size:14px}
    @media (max-width: 1180px){
      .main{grid-template-columns:1fr}
      .sticky{position:static;max-height:none}
      .topbar{grid-template-columns:1fr 1fr 1fr;align-items:end}
      .brand{grid-column:1/-1}
    }
    @media (max-width: 760px){
      .row2,.row3,.toggle,.toggles,.quoteGrid,.adjustGrid,.smallGrid,.chipGrid{grid-template-columns:1fr}
      .topbar{grid-template-columns:1fr}
      .miniField input{min-width:0}
    }
  </style>
</head>
<body>
<div class="wrap">

  <div class="topbar">
    <div class="brand">
      <h1>QUOTE CALCULATOR</h1>
    </div>

    <div class="miniField">
      <label>Date</label>
      <input id="topDate" type="date">
    </div>
    <div class="miniField">
      <label>Time</label>
      <input id="topTime" type="time">
    </div>

    <button class="btn btn-primary" id="clearBtn" type="button">NEW LEAD (Clear)</button>
    <button class="btn btn-soft" id="copyBtn" type="button">Copy Quote Line</button>
  </div>

  <div class="main">

    <!-- LEFT: CUSTOMER INFO -->
    <section class="card sticky">
      <div class="head">
        <span>Customer info</span>
        <button class="btn btn-soft" id="collapseCustomer" type="button" style="height:30px;padding:0 10px;font-size:12px;">Collapse</button>
      </div>
      <div class="body stack" id="customerBody">
        <div class="field">
          <label>Customer Name</label>
          <input id="custName" type="text" placeholder="First + Last">
        </div>

        <div class="field">
          <label>Lead Source</label>
          <input id="custLeadSource" type="text" placeholder="Call / Web / Referral / Other">
        </div>

        <div class="row2">
          <div class="field">
            <label>Phone</label>
            <input id="custPhone" type="text" placeholder="(###) ###-####">
          </div>
          <div class="field">
            <label>Email</label>
            <input id="custEmail" type="email" placeholder="name@email.com">
          </div>
        </div>

        <div class="field">
          <label>Address</label>
          <input id="custAddress" type="text" placeholder="Street, City, State, ZIP">
        </div>

        <div class="field">
          <label>Notes</label>
          <textarea id="custNotes" placeholder="Objections, pests, timing, gate code, special instructions..."></textarea>
        </div>

        <div class="miniPanel" style="background:#fff7fb;border-style:dashed;">
          <h4>Checklist</h4>
          <div class="chipGrid">
            <label class="chip"><input type="checkbox" id="chkINT"> INT</label>
            <label class="chip"><input type="checkbox" id="chkPS"> PS</label>
            <label class="chip"><input type="checkbox" id="chkWD"> WD</label>
            <label class="chip"><input type="checkbox" id="chkGR"> GR</label>
            <label class="chip"><input type="checkbox" id="chkLB"> LB</label>
            <label class="chip"><input type="checkbox" id="chkRS"> RS</label>
          </div>
        </div>
      </div>
    </section>

    <!-- CENTER: TOTALS + TOGGLES -->
    <div class="stack">
      <section class="card">
        <div class="head">Quote (read this)</div>
        <div class="body stack">

          <div class="quoteGrid">
            <div class="metric">
              <div class="k">QT Rate</div>
              <div class="v" id="qtRateDisplay">$0.00</div>
              <div class="sub">Monthly: <span id="qtMonthlyDisplay">$0</span></div>
            </div>
            <div class="metric">
              <div class="k">SM Rate</div>
              <div class="v" id="smRateDisplay">$0.00</div>
              <div class="sub">Monthly: <span id="smMonthlyDisplay">$0</span></div>
            </div>
            <div class="metric big">
              <div class="k">Total monthly</div>
              <div class="v" id="totalMonthlyDisplay">$0 / mo</div>
              <div class="sub">YIF Total: <span id="totalYifDisplay">$0.00</span></div>
            </div>
            <div class="metric big">
              <div class="k">Bundle total monthly</div>
              <div class="v" id="bundleMonthlyDisplay">$0 / mo</div>
              <div class="sub">Bundle YIF: <span id="bundleYifDisplay">$0.00</span></div>
            </div>
          </div>

          <div class="miniPanel" style="background:#fff7fb;border:1px solid var(--line);">
            <h4>Totals</h4>
            <div class="totalsList">
              <div class="totalsRow"><span class="lab">Bundle QT (pest after -$10)</span><span class="amt" id="bundleQtRow">$0.00</span></div>
              <div class="totalsRow"><span class="lab">Plain total monthly (selected services)</span><span class="amt" id="plainMonthlyRow">$0 / mo</span></div>
              <div class="totalsRow"><span class="lab">Bundle total monthly</span><span class="amt" id="bundleMonthlyRow">$0 / mo</span></div>
              <div class="totalsRow"><span class="lab">Plain YIF total</span><span class="amt" id="plainYifRow">$0.00</span></div>
              <div class="totalsRow"><span class="lab">Bundle YIF total</span><span class="amt" id="bundleYifRow">$0.00</span></div>
            </div>
          </div>

        </div>
      </section>

      <section class="card">
        <div class="head">Services</div>
        <div class="body stack">
          <div class="toggles">
            <button class="toggle on" id="btnPest" type="button">Pest</button>
            <button class="toggle" id="btnTermite" type="button">Termite (SM)</button>
            <button class="toggle" id="btnYIF" type="button">YIF</button>
            <button class="toggle" id="btnBundle" type="button">Bundle</button>
          </div>
          </div>
      </section>
    </div>

    <!-- RIGHT: MEASUREMENTS + ADJUST -->
    <div class="stack">
      <section class="card">
        <div class="head">Measurements</div>
        <div class="body stack">
          <div class="miniPanel">
            <h4>Measurements</h4>
            <div class="row2">
              <div class="field compact">
                <label>SqFt</label>
                <input id="sqft" type="number" min="0" step="1" placeholder="">
              </div>
              <div class="field compact">
                <label>Linear ft (LF)</label>
                <input id="lf" type="number" min="0" step="1" placeholder="">
              </div>
            </div>

            <details style="margin-top:8px">
              <summary>Show pricing tiers</summary>
              <div style="margin-top:8px;overflow:auto">
                <table>
                  <thead>
                    <tr><th>SqFt Range</th><th class="right">QT Rate</th></tr>
                  </thead>
                  <tbody id="tiersTable"></tbody>
                </table>
              </div>
            </details>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="head">Adjust rates (only if needed)</div>
        <div class="body stack">
          <div class="adjustGrid">

            <div class="adjustBox">
              <h5><span>PEST (QT)</span><span>Suggested: <span id="qtSuggestedLabel">$0.00</span></span></h5>
              <div class="smallGrid">
                <div class="field mini">
                  <label>QT Quote</label>
                  <input id="pestQuote" type="number" step="0.01" placeholder="Auto">
                </div>
                <div class="field mini">
                  <label>Initial Fee</label>
                  <input id="pestInit" type="number" step="1" value="399">
                </div>
                <div class="field mini">
                  <label>QT Monthly</label>
                  <input id="pestMonthlyRead" class="readonly" type="text" readonly>
                </div>
                <div class="field mini">
                  <label>Pest YIF</label>
                  <input id="pestYifRead" class="readonly" type="text" readonly>
                </div>
              </div>
            </div>

            <div class="adjustBox">
              <h5><span>TERMITE (SM)</span><span>Suggested: <span id="smSuggestedLabel">$0.00</span></span></h5>
              <div class="smallGrid">
                <div class="field mini">
                  <label>SM Quote</label>
                  <input id="termQuote" type="number" step="0.01" placeholder="Auto">
                </div>
                <div class="field mini">
                  <label>SM Install Fee</label>
                  <input id="termInstall" type="number" step="1" value="0">
                </div>
                <div class="field mini">
                  <label>SM Monthly</label>
                  <input id="smMonthlyRead" class="readonly" type="text" readonly>
                </div>
                <div class="field mini">
                  <label>Termite YIF</label>
                  <input id="termYifRead" class="readonly" type="text" readonly>
                </div>
              </div>
            </div>

          </div>
        </div>
      </section>
    </div>

  </div>
</div>

<script>
(function(){
  const YIF_DISCOUNT = 0.05;        // fixed 5%
  const TERMITE_RATE_PER_LF = 1.5;  // yearly
  const BUNDLE_DISC = 10;           // fixed $10 off QT

  const tiers = [
    {min:1000,max:1499,qt:139},
    {min:1500,max:2499,qt:159},
    {min:2500,max:3499,qt:179},
    {min:3500,max:3999,qt:199},
    {min:4000,max:4499,qt:209},
    {min:4500,max:999999,qt:219},
  ];

  const $ = (id)=>document.getElementById(id);
  const state = { pestOn:true, termiteOn:false, yifOn:false, bundleOn:false };

  function money(n){ return (Number(n)||0).toLocaleString(undefined,{style:'currency',currency:'USD'}); }
  function money0(n){ return (Number(n)||0).toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:0}); }
  function ceil(n){ return Math.ceil(Number(n)||0); }

  function suggestQt(sqft){
    const s = Number(sqft);
    if(!Number.isFinite(s) || s<=0) return 0;
    for(const t of tiers){
      if(s>=t.min && s<=t.max) return t.qt;
    }
    return 0;
  }

  function setNow(){
    const d = new Date();
    $('topDate').value = d.toISOString().slice(0,10);
    $('topTime').value = String(d.getHours()).padStart(2,'0') + ':' + String(d.getMinutes()).padStart(2,'0');
  }

  function initTiers(){
    const tb = $('tiersTable');
    tb.innerHTML = '';
    tiers.forEach(t=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${t.min.toLocaleString()} - ${t.max===999999 ? 'up' : t.max.toLocaleString()}</td>
        <td class="right">${money(t.qt)}</td>
      `;
      tb.appendChild(tr);
    });
  }

  function updateChecklistChips(){
    document.querySelectorAll('.chip').forEach(c=>{
      const i = c.querySelector('input');
      c.classList.toggle('on', !!i?.checked);
    });
  }

  function updateTogglesUI(){
    const map = [
      ['btnPest', state.pestOn],
      ['btnTermite', state.termiteOn],
      ['btnYIF', state.yifOn],
      ['btnBundle', state.bundleOn],
    ];
    map.forEach(([id,on])=>{
      const b = $(id);
      b.classList.toggle('on', !!on);
    });
  }

  function calc(){
    const sqft = parseFloat($('sqft').value);
    const lf = parseFloat($('lf').value);

    const qtSuggested = suggestQt(sqft);
    const smSuggested = (Number.isFinite(lf) && lf>0) ? (lf * TERMITE_RATE_PER_LF) : 0;

    $('qtSuggestedLabel').textContent = money(qtSuggested);
    $('smSuggestedLabel').textContent = money(smSuggested);

    const pestQuoteIn = parseFloat($('pestQuote').value);
    const termQuoteIn = parseFloat($('termQuote').value);

    const pestQtBase = Number.isFinite(pestQuoteIn) ? pestQuoteIn : qtSuggested;
    const termSmBase = Number.isFinite(termQuoteIn) ? termQuoteIn : smSuggested;

    const pestInit = parseFloat($('pestInit').value) || 0;
    const termInstall = parseFloat($('termInstall').value) || 0;

    const bundleApplies = state.bundleOn && state.pestOn && state.termiteOn;
    const pestQtBundled = bundleApplies ? Math.max(0, pestQtBase - BUNDLE_DISC) : pestQtBase;

    const pestMonthlyPlain = state.pestOn ? ceil(pestQtBase/3) : 0;
    const pestMonthlyBundle = state.pestOn ? ceil(pestQtBundled/3) : 0;
    const smMonthly = state.termiteOn ? ceil(termSmBase/12) : 0;

    // YIF after fees
    let pestYifPlain = 0, pestYifBundle = 0;
    if(state.pestOn){
      const basePlain = (pestQtBase*4) + pestInit;
      const baseBundle = (pestQtBundled*4) + pestInit;
      pestYifPlain = state.yifOn ? basePlain * (1 - YIF_DISCOUNT) : basePlain;
      pestYifBundle = state.yifOn ? baseBundle * (1 - YIF_DISCOUNT) : baseBundle;
    }

    let smYif = 0;
    if(state.termiteOn){
      const base = termSmBase + termInstall;
      smYif = state.yifOn ? base * (1 - YIF_DISCOUNT) : base;
    }

    const plainMonthlyTotal = (state.pestOn ? pestMonthlyPlain : 0) + (state.termiteOn ? smMonthly : 0);
    const bundleMonthlyTotal = (state.pestOn ? pestMonthlyBundle : 0) + (state.termiteOn ? smMonthly : 0);

    const plainYifTotal = pestYifPlain + smYif;
    const bundleYifTotal = pestYifBundle + smYif;

    // Center big readouts (respect current bundle toggle, but only applies when valid)
    const shownQt = state.pestOn ? (bundleApplies ? pestQtBundled : pestQtBase) : 0;
    const shownQtMo = state.pestOn ? (bundleApplies ? pestMonthlyBundle : pestMonthlyPlain) : 0;

    $('qtRateDisplay').textContent = money(shownQt);
    $('qtMonthlyDisplay').textContent = money0(shownQtMo);

    $('smRateDisplay').textContent = money(state.termiteOn ? termSmBase : 0);
    $('smMonthlyDisplay').textContent = money0(smMonthly);

    $('totalMonthlyDisplay').textContent = `${money0(plainMonthlyTotal)} / mo`;
    $('totalYifDisplay').textContent = money(plainYifTotal);

    $('bundleMonthlyDisplay').textContent = `${money0(bundleMonthlyTotal)} / mo`;
    $('bundleYifDisplay').textContent = money(bundleYifTotal);

    // Totals panel
    $('bundleQtRow').textContent = money(state.pestOn ? pestQtBundled : 0);
    $('plainMonthlyRow').textContent = `${money0(plainMonthlyTotal)} / mo`;
    $('bundleMonthlyRow').textContent = `${money0(bundleMonthlyTotal)} / mo`;
    $('plainYifRow').textContent = money(plainYifTotal);
    $('bundleYifRow').textContent = money(bundleYifTotal);

    // Right read-only fields
    $('pestMonthlyRead').value = money0(pestMonthlyPlain);
    $('pestYifRead').value = money(pestYifPlain);

    $('smMonthlyRead').value = money0(smMonthly);
    $('termYifRead').value = money(smYif);

    // Copy line (uses current view + totals)
    const parts = [];
    if(state.pestOn) parts.push(`QT ${money(shownQt)} (${money0(shownQtMo)}/mo)`);
    if(state.termiteOn) parts.push(`SM ${money(termSmBase)} (${money0(smMonthly)}/mo)`);
    if(state.yifOn) parts.push(`YIF ${money(bundleApplies ? bundleYifTotal : plainYifTotal)}`);
    if(bundleApplies) parts.push(`Bundle (-$10/QT)`);
    $('copyBtn').dataset.quote = parts.join(' | ');
  }

  function clearAll(){
    setNow();
    ['custName','custLeadSource','custPhone','custEmail','custAddress','custNotes'].forEach(id=>$(id).value='');
    ['chkINT','chkPS','chkWD','chkGR','chkLB','chkRS'].forEach(id=>$(id).checked=false);
    updateChecklistChips();

    $('sqft').value = '';
    $('lf').value = '';
    $('pestQuote').value = '';
    $('termQuote').value = '';
    $('pestInit').value = '399';
    $('termInstall').value = '0';

    state.pestOn = true;
    state.termiteOn = false;
    state.yifOn = false;
    state.bundleOn = false;
    updateTogglesUI();

    calc();
  }

  function copyQuote(){
    const txt = $('copyBtn').dataset.quote || '';
    if(!txt) return;
    navigator.clipboard.writeText(txt).then(()=>{
      const old = $('copyBtn').textContent;
      $('copyBtn').textContent = 'Copied';
      setTimeout(()=> $('copyBtn').textContent = old, 900);
    }).catch(()=> alert('Copy failed. Copy manually.'));
  }

  // Wire
  $('collapseCustomer').addEventListener('click', ()=>{
    $('customerBody').classList.toggle('hide');
    $('collapseCustomer').textContent = $('customerBody').classList.contains('hide') ? 'Expand' : 'Collapse';
  });

  ['chkINT','chkPS','chkWD','chkGR','chkLB','chkRS'].forEach(id=>{
    $(id).addEventListener('change', updateChecklistChips);
  });

  [['btnPest','pestOn'],['btnTermite','termiteOn'],['btnYIF','yifOn'],['btnBundle','bundleOn']]
    .forEach(([id,key])=>{
      $(id).addEventListener('click', ()=>{
        state[key] = !state[key];
        updateTogglesUI();
        calc();
      });
    });

  ['sqft','lf','pestQuote','pestInit','termQuote','termInstall'].forEach(id=>{
    $(id).addEventListener('input', calc);
  });

  $('clearBtn').addEventListener('click', clearAll);
  $('copyBtn').addEventListener('click', copyQuote);

  initTiers();
  setNow();
  updateChecklistChips();
  updateTogglesUI();
  calc();
})();
</script>
</body>
</html>
